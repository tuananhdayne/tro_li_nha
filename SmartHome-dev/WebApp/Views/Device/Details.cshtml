@model DAO.BaseModels.Device
@{
    ViewData["Title"] = Model.Name;
    var icon = Model.Type switch
    {
        "Light" => "üí°",
        "DoorLock" => "üîí",
        "TemperatureHumiditySensor" => "üå°Ô∏è",
        "MotionSensor" => "üëÅÔ∏è",
        _ => "üì±"
    };
}

<div class="page-header">
    <h1 class="page-title">@icon @Model.Name</h1>
    <p class="page-subtitle">@Model.Type - @Model.MacAddress</p>
</div>

<a asp-action="Index" asp-route-roomId="@Model.RoomID" class="btn btn-outline mb-2">‚Üê Quay l·∫°i</a>

<div class="grid">
    <!-- Th√¥ng tin thi·∫øt b·ªã -->
    <div class="card">
        <h3 class="card-title">Th√¥ng tin</h3>
        <table>
            <tr><td>T√™n</td><td>@Model.Name</td></tr>
            <tr><td>Lo·∫°i</td><td>@Model.Type</td></tr>
            <tr><td>MAC</td><td>@Model.MacAddress</td></tr>
            <tr><td>Tr·∫°ng th√°i</td><td>@(Model.Status ?? "N/A")</td></tr>
            <tr><td>Ph√≤ng ID</td><td>@Model.RoomID</td></tr>
        </table>
    </div>
    
    <!-- ƒêi·ªÅu khi·ªÉn -->
    @if (Model.Type == "Light" || Model.Type == "DoorLock")
    {
        <div class="card">
            <h3 class="card-title">ƒêi·ªÅu khi·ªÉn</h3>
            <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                <button class="btn btn-primary" onclick="controlDevice('on')">B·∫≠t</button>
                <button class="btn btn-danger" onclick="controlDevice('off')">T·∫Øt</button>
            </div>
        </div>
    }
    
    <!-- D·ªØ li·ªáu c·∫£m bi·∫øn -->
    @if (Model.Type == "TemperatureHumiditySensor")
    {
        <div class="card">
            <h3 class="card-title">D·ªØ li·ªáu c·∫£m bi·∫øn</h3>
            <div style="display: flex; gap: 2rem; margin-top: 1rem;">
                <div class="text-center">
                    <div class="sensor-value" id="tempValue">--</div>
                    <div class="sensor-label">¬∞C Nhi·ªát ƒë·ªô</div>
                </div>
                <div class="text-center">
                    <div class="sensor-value" id="humValue">--</div>
                    <div class="sensor-label">% ƒê·ªô ·∫©m</div>
                </div>
            </div>
        </div>
    }
    
    @if (Model.Type == "MotionSensor")
    {
        <div class="card">
            <h3 class="card-title">Tr·∫°ng th√°i ph√°t hi·ªán</h3>
            <div class="text-center" style="margin-top: 1rem;">
                <div class="sensor-value" id="motionValue">--</div>
                <div class="sensor-label">Ph√°t hi·ªán chuy·ªÉn ƒë·ªông</div>
            </div>
        </div>
    }
</div>

@section Scripts {
<script>
var deviceId = @Model.ID;
var deviceType = '@Model.Type';

function controlDevice(cmd) {
    fetch(`/api/device/control/${deviceId}`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ command: cmd })
    }).then(res => {
        if (res.ok) {
            alert('ƒê√£ g·ª≠i l·ªánh: ' + cmd);
        } else {
            alert('L·ªói ƒëi·ªÅu khi·ªÉn');
        }
    });
}

function loadTelemetry() {
    fetch(`/api/device/${deviceId}/telemetry`)
        .then(res => res.json())
        .then(data => {
            if (deviceType === 'TemperatureHumiditySensor') {
                document.getElementById('tempValue').textContent = data.temperature?.toFixed(1) || '--';
                document.getElementById('humValue').textContent = data.humidity?.toFixed(1) || '--';
            } else if (deviceType === 'MotionSensor') {
                document.getElementById('motionValue').textContent = data.motion ? 'C√≥' : 'Kh√¥ng';
            }
        })
        .catch(() => {});
}

if (deviceType === 'TemperatureHumiditySensor' || deviceType === 'MotionSensor') {
    loadTelemetry();
    setInterval(loadTelemetry, 5000);
}
</script>
}
